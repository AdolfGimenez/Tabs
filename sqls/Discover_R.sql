--recap rechazados

SELECT DI.INCOMING_DATE, DI.ERROR_DESCRIPTION, DI.RRN_BEPSA, DI.*
FROM JPTSAPI.DISCOVER_INBOUND DI
WHERE DI.INBOUND_STATUS = 'DEFECT' AND DI.INCOMING_DATE  BETWEEN '2025-07-04 00:00:00.002724'
    AND '2025-07-23 23:59:59.002724'
      AND DI.ERROR_DESCRIPTION LIKE '%FAILED%' ORDER BY INCOMING_DATE ASC;

/*ALTERNATE_SETTLEMENT_CURRENCY_AMOUNT = RBS FX Rate DEL reporte
ALTERNATE_SETTLEMENT_EXCHANGE_AMOUNT = AMOUNT_AUTHORIZED/ALTERNATE_SETTLEMENT_CURRENCY_AMOUNT*/
UPDATE
    JPTSAPI.DISCOVER_INBOUND
SET ALTERNATE_SETTLEMENT_CURRENCY_AMOUNT = 7306
WHERE INCOMING_MESSAGE_ID IN (571,700,754,1058,1095);
    /*INBOUND_STATUS = 'DEFECT'
  AND INCOMING_DATE BETWEEN '2025-07-04 00:00:00.002724' AND '2025-07-22 23:59:59.002724'
  AND ERROR_DESCRIPTION LIKE '%FAILED%';*/

SELECT d.AMOUNT_AUTHORIZED, d.ALTERNATE_SETTLEMENT_CURRENCY_AMOUNT,
TRIM(REPLACE(TO_CHAR(ROUND(DECIMAL(d.AMOUNT_AUTHORIZED, 12, 0) / DECIMAL(d.ALTERNATE_SETTLEMENT_CURRENCY_AMOUNT, 12, 0),2),'9999999990D00'),',', '.')) column_usd,
d.ALTERNATE_SETTLEMENT_EXCHANGE_AMOUNT
FROM JPTSAPI.DISCOVER_INBOUND d
WHERE INCOMING_MESSAGE_ID IN (571,700,754,1058,1095);
    /*d.INBOUND_STATUS = 'DEFECT'
AND d.INCOMING_DATE BETWEEN '2025-07-04 00:00:00.002724' AND '2025-07-22 23:59:59.002724'
AND d.ERROR_DESCRIPTION LIKE '%FAILED%'
ORDER BY d.INCOMING_DATE ASC;*/

UPDATE JPTSAPI.DISCOVER_INBOUND
SET ALTERNATE_SETTLEMENT_EXCHANGE_AMOUNT =
TRIM(REPLACE(TO_CHAR(ROUND(DECIMAL(AMOUNT_AUTHORIZED, 12, 0) / DECIMAL(ALTERNATE_SETTLEMENT_CURRENCY_AMOUNT, 12, 0),2),'9999999990D00'),',', '.'))
WHERE INCOMING_MESSAGE_ID IN (571,700,754,1058);
/*WHERE INBOUND_STATUS = 'DEFECT'
AND INCOMING_DATE BETWEEN '2025-07-04 00:00:00.002724' AND '2025-07-22 23:59:59.002724'
AND ERROR_DESCRIPTION LIKE '%FAILED%';--258
*/
UPDATE
    JPTSAPI.DISCOVER_INBOUND
SET INBOUND_STATUS = 'PENDING'
WHERE INCOMING_MESSAGE_ID IN (571,700,754,1058,1095);
/*WHERE INBOUND_STATUS = 'DEFECT' --PENDING
  AND INCOMING_DATE BETWEEN '2025-07-04 00:00:00.002724' AND '2025-07-22 23:59:59.002724'
  AND ERROR_DESCRIPTION LIKE '%FAILED%';*/
--AND RRN_BEPSA IN ('578509040223', '578509063165', '578509227719', '578509231837', '578509232409', '578509271909', '578509316265', '578509367459', '578509413941', '578509415719', '578509473371', '578509482241', '578509535459', '578509584851', '578509680221', '578509750869', '578509754019', '578609988371', '578600176077', '578600224301', '578600249851', '578600341623', '578600371629', '578600392381', '578600398201', '578600455007', '578600474893', '578600479829', '578600527389', '578600527397', '578600536793', '578600538775', '578600547617', '578600549857', '578600568095', '578600578819', '578600606085', '578600632043', '578600632515', '578600641681', '578600657299', '578600659625', '578600664479', '578600676351', '578600678511', '578600685773', '578600686465', '578600691219', '578600703659', '578600710509', '578600716917', '578600724247', '578600733017', '578600737227', '578600750317', '578600779351', '578600782417', '578600795821', '578701006961', '578701110211', '578701246831', '578701249513', '578701273337', '578701274227', '578701280213', '578701293859', '578701301659', '578701317199', '578701328201', '578701332635', '578701343001', '578701389933', '578701401137', '579607595949', '579607616915', '579607619139', '579607643389', '579607653257', '579607675935', '579607682809', '579607693341', '579607719249', '579607736593', '579607754733', '579607758979', '579607789505', '579607809483', '579607809007', '579607810533', '579607815399', '579607821165', '579607877973', '579607935785', '579607981875', '579607990177', '579607997211', '579608002683', '579608003797', '579608020983', '579608092115', '579608109923', '579608109943', '579608126523', '579608128127', '579608139931', '579708332439', '579708387673', '579708390231', '579708393147', '579708401007', '579708430665', '579708456887', '579708470903', '579708517005', '579708524169', '579708547527', '579708554635', '579708569095', '579708571747', '579708577969', '579708621807', '579708635837', '579708650113', '579708662355', '579708665611', '579708701713', '579708720077', '579708730657', '579708745887', '579708872897', '579708911449', '579708973161', '579709004681', '579809035821', '579809043379', '579809044491', '579809107291', '579809116739', '579809127821', '579809216391', '579809216847', '579809224649', '579809237821', '579809259225', '579809258995', '579809280727', '579809291987', '579809300651', '579809321467', '579809321597', '579809323081', '579809323061', '579809324071', '579809350665', '579809367383', '579809376169', '579809388105', '579809396325', '579809402169', '579809433273', '579809437851', '579809438791', '579809444331', '579809448505', '579809461429', '579809478461', '579809480229', '579809485323', '579809503341', '579809510391', '579809522317', '579809564617', '579809621737', '579809702819', '579909711765', '579909712561', '579909863235', '579909954381', '579909955211', '579909962861', '579909969143', '579909970111', '579909970301', '579909995345', '579900003857', '579900019455', '579900044321', '579900044727', '579900063659', '579900071115', '579900078755', '579900091331', '579900107679', '579900122971', '579900125097', '579900135297', '579900139129', '579900142893', '579900143691', '579900146427', '579900152591', '579900165813', '579900180589', '579900184239', '579900223757', '579900303811', '579900312429', '579900388231', '579900446475', '580000594799', '580000620133', '580000641921', '580000667127', '580000687649', '580000689411', '580000704369', '580000708103', '580000751369', '580000763511', '580000770613', '580000771135', '580000781029', '580000784905', '580000789387', '580000796559', '580000807165', '580000817631', '580000819799', '580000819339', '580000841481', '580000841417', '580000851609', '580000866971', '580000874373', '580000879525', '580000882519', '580000909513', '580000910369', '580000911107', '580000939291', '580000945727', '580000965391', '580000966229', '580000973705', '580000977485', '580000979255', '580000980823', '580000988947', '580000990185', '580000994407', '580001000789', '580001005609', '580001023703', '580001037917', '580001064767', '580001083313', '580001090307', '580001120699');
SELECT * FROM GXTRJDTA.TDGCOT T ORDER BY COTFECHA DESC; --se toma COTCOMPRA con COTTPCOT=MRC
----------------------------------------------------------------------------------
SELECT *
FROM JPTSAPI.DISCOVER_INBOUND DI
WHERE  DI.INCOMING_DATE  BETWEEN '2025-07-04 00:00:00.002724'
    AND '2025-07-23 23:59:59.002724' AND DI.ERROR_DESCRIPTION LIKE '%FAILED%' ORDER BY INCOMING_DATE ASC;

UPDATE
    JPTSAPI.DISCOVER_INBOUND
SET INBOUND_STATUS = 'DEFECT'
WHERE INCOMING_MESSAGE_ID IN (296, 345, 353, 369, 361, 370, 388, 390, 386, 347, 378, 368, 384, 385, 349, 348, 391,352, 442, 448, 433, 432, 395, 371, 426, 407, 430, 450, 428, 436, 447, 435, 389, 431,434, 186, 256, 376, 377, 440, 449, 414, 429, 443, 439, 445, 444, 446, 452, 438, 441,342, 451, 427, 423, 408, 383, 437, 344, 366, 381, 287, 375, 367, 394, 396, 397, 304,
398, 399, 343, 310, 337, 559, 560, 561, 562, 563, 564, 565, 566, 567, 568, 569, 570,571, 572, 573, 574, 575, 576, 577, 579, 580, 582, 583, 584, 585, 586, 588, 589, 590,591, 592, 593, 596, 597, 598, 599, 600, 601, 602, 603, 604, 605, 606, 607, 608, 609,610, 611, 613, 614, 616, 617, 618, 619, 620, 621, 622, 624, 625, 626, 627, 628, 629,
630, 631, 632, 634, 635, 636, 638, 639, 640, 643, 644, 645, 646, 647, 648, 649, 650,651, 652, 653, 654, 655, 656, 657, 658, 659, 660, 661, 662, 663, 664, 665, 666, 669,670, 672, 673, 674, 675, 676, 677, 678, 679, 680, 681, 682, 683, 684, 685, 686, 688,689, 691, 692, 693, 694, 695, 696, 697, 698, 699, 700, 701, 702, 703, 704, 709, 710,
712, 713, 714, 716, 717, 718, 719, 720, 721, 723, 724, 725, 726, 727, 728, 729, 730,731, 732, 733, 734, 735, 736, 737, 738, 740, 741, 742, 747, 748, 749, 750, 751, 752,753, 754, 755, 756, 757, 758, 759, 760, 761, 762, 763, 764, 765, 766, 767, 768, 769,770, 771, 774);

SELECT * FROM GXTRJDTA.TDGCOT T WHERE T.COTFECHA>='20250728';

SELECT * FROM WRKADOLFO.BKDISCOVER;
SELECT * FROM JPTSAPI.DISCOVER_INBOUND WHERE INCOMING_MESSAGE_ID IN (571,700,754,1058,1095);

SELECT * FROM JPTSAPI.RECAP_COUNTERS RC;
SELECT * FROM WRKADOLFO.BKDISCOVER050 ;
SELECT * FROM JPTSAPI.DISCOVER_INBOUND WHERE RECAP_NUMBER_ORIGINAL LIKE '%060>050>DI%';

--SELECT * FROM JPTSAPI.DISCOVER_INBOUND DI
UPDATE
    JPTSAPI.DISCOVER_INBOUND
SET INBOUND_STATUS = 'PENDING'
WHERE INCOMING_MESSAGE_ID IN
(186,256,287,296,304,310,337,342,343,344,345,347,348,349,352,353,361,366,367,368,369,370,371,375,376,377,378,381,383,384,385,386,
388,389,390,391,394,395,396,397,398,399,407,408,414,423,426,427,428,429,430,431,432,433,434,435,436,437,438,439,440,441,442,443,
444,445,446,447,448,449,450,451,452,559,560,561,562,563,564,565,566,567,568,569,570,572,573,574,575,576,577,579,580,582,583,584,
585,586,588,589,590,591,592,593,596,597,598,599,600,601,602,603,604,605,606,607,608,609,610,611,613,614,616,617,618,619,620,621,
622,624,625,626,627,628,629,630,631,632,634,635,636,638,639,640,643,644,645,646,647,648,649,650,651,652,653,654,655,656,657,658,
659,660,661,662,663,664,665,666,669,670,672,673,674,675,676,677,678,679,680,681,682,683,684,685,686,688,689,691,692,693,694,695,
696,697,698,699,701,702,703,704,709,710,712,713,714,716,717,718,719,720,721,723,724,725,726,727,728,729,730,731,732,733,734,735,
736,737,738,740,741,742,747,748,749,750,751,752,753,755,756,757,758,759,760,761,762,763,764,765,766,767,768,769,770,771,774,
1025,1027,1028,1029,1030,1031,1034,1035,1036,1038,1039,1040,1041,1042,1043,1044,1045,1046,1047,1048,1049,1050,1051,1052,1053,1054,1055,1059,1060,1061);

SELECT * FROM JPTSAPI.DISCOVER_INBOUND WHERE RECAP_NUMBER_ORIGINAL LIKE '%060>011>X3%';

SELECT * FROM JPTSAPI.DISCOVER_INBOUND DI WHERE DI.RECEIVING_INSTITUTION_ID='X3';
SELECT * FROM JPTSAPI.DISCOVER_INBOUND DI WHERE DI.INBOUND_STATUS='PENDING' AND DI.INCOMING_DATE<'2025-07-31 23:59:59.724707';